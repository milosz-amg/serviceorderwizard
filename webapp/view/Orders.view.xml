<mvc:View
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:smartTable="sap.ui.comp.smarttable"
    controllerName="com.mr.serviceorderwizard.controller.Orders"
>
    <Page
        id="ordersPage"
        title="{i18n>ordersPageTitle}"
    >
        <content>
            <!-- Table view -->
            <VBox fitContainer="true">
                <smartFilterBar:SmartFilterBar
                    id="smartFilterBar"
                    entitySet="orderSet"
                    persistencyKey="SmartFilter_Orders"
                    enableBasicSearch="true"
                    
                >
                    <smartFilterBar:controlConfiguration>
                        <smartFilterBar:ControlConfiguration
                            key="OrderCreationDate"
                            label="{i18n>orderCreationDateFilterLabel}"
                            visibleInAdvancedArea="true"
                        >
                            <smartFilterBar:customControl>
                                <DateRangeSelection
                                    id="orderDateFilter"
                                    placeholder="{i18n>orderCreationDatePlaceholder}"
                                    width="250px"
                                    change="onFilterChange"

                                />
                            </smartFilterBar:customControl>
                        </smartFilterBar:ControlConfiguration>

                        <smartFilterBar:ControlConfiguration
                            key="OrderVisitDate"
                            label="{i18n>orderVisitDateFilterLabel}"
                            visibleInAdvancedArea="true"
                        >
                            <smartFilterBar:customControl>
                                <DateRangeSelection
                                    id="orderVisitDateFilter"
                                    placeholder="{i18n>visitDatePlaceholder}"
                                    width="250px"
                                    change="onFilterChange"

                                />
                            </smartFilterBar:customControl>
                        </smartFilterBar:ControlConfiguration>

                        <smartFilterBar:ControlConfiguration
                            key="Status"
                            label="{i18n>statusFilterLabel}"
                            visibleInAdvancedArea="true"
                        >
                            <smartFilterBar:customControl>
                                <MultiComboBox
                                    id="statusFilter"
                                    selectionChange="onFilterChange"
                                    width="200px"
                                    placeholder="{i18n>statusFilterPlaceholder}"
                                >
                                    <core:Item
                                        key="New"
                                        text="{i18n>statusNew}"
                                    />
                                    <core:Item
                                        key="In progress"
                                        text="{i18n>statusInProgress}"
                                    />
                                    <core:Item
                                        key="Completed"
                                        text="{i18n>statusCompleted}"
                                    />
                                </MultiComboBox>
                            </smartFilterBar:customControl>
                        </smartFilterBar:ControlConfiguration>
                    </smartFilterBar:controlConfiguration>

                    <smartFilterBar:layoutData>
                        <FlexItemData shrinkFactor="0" />
                    </smartFilterBar:layoutData>
                </smartFilterBar:SmartFilterBar>

                <smartTable:SmartTable
                    id="ordersSmartTable"
                    entitySet="orderSet"
                    smartFilterId="smartFilterBar"
                    tableType="Table"
                    enableExport="true"
                    useVariantManagement="true"
                    header="{i18n>smartTableHeader}"
                    showRowCount="true"
                    persistencyKey="SmartTable_Orders"
                    useTablePersonalisation="true"
                    enableAutoBinding="true"
                    class="sapUiResponsiveContentPadding"
                    enableAutoColumnWidth="true"
                    beforeRebindTable="onBeforeRebindTable"
                >
                    <!-- layout data used to make the table growing but the filter bar fixed -->
                    <smartTable:layoutData>
                        <FlexItemData
                            growFactor="1"
                            baseSize="0%"
                        />
                    </smartTable:layoutData>

                    <!-- Custom Toolbar with Status Filter -->
                    <smartTable:customToolbar>
                        <OverflowToolbar design="Transparent">
                            <ToolbarSpacer />
                            <OverflowToolbarButton
                                icon="sap-icon://refresh"
                                text="{i18n>refreshTableButton}"
                                press="onRefreshTable"
                                
                            />
                        </OverflowToolbar>
                    </smartTable:customToolbar>

                    <table:Table
                        visibleRowCount="15"
                    >
                        <!-- Order ID Column with leading zeros removed -->
                        <table:Column sortProperty="OrderId">
                            <table:customData>
                                <core:CustomData
                                    key="p13nData"
                                    value='{"columnKey": "OrderId", "leadingProperty": "OrderId", "columnIndex": 0}'
                                />
                            </table:customData>
                            <Label text="{i18n>tableHeaderOrderId}" />
                            <table:template>
                                <Text
                                    text="{path: 'OrderId', formatter: '.formatter.formatOrderId'}"
                                />
                            </table:template>
                        </table:Column>

                        <!-- Order Creation Date Column with DD.MM.YYYY format -->
                        <table:Column
                            sortProperty="OrderCreationDate"
                            sorted="true"
                            sortOrder="Descending"
                        >
                            <table:customData>
                                <core:CustomData
                                    key="p13nData"
                                    value='{"columnKey": "OrderCreationDate", "leadingProperty": "OrderCreationDate", "columnIndex": 1}'
                                />
                            </table:customData>
                            <Label text="{i18n>tableHeaderOrderCreationDate}" />
                            <table:template>
                                <Text
                                    text="{path: 'OrderCreationDate', formatter: '.formatter.formatDate'}"
                                />
                            </table:template>
                        </table:Column>

                        <!-- Visit Date Column with DD.MM.YYYY format -->
                        <table:Column
                            sortProperty="Visitdate"
                            sorted="true"
                            sortOrder="Ascending"
                        >
                            <table:customData>
                                <core:CustomData
                                    key="p13nData"
                                    value='{"columnKey": "Visitdate", "leadingProperty": "Visitdate", "columnIndex": 2}'
                                />
                            </table:customData>
                            <Label text="{i18n>tableHeaderVisitDate}" />
                            <table:template>
                                <Text
                                    text="{path: 'Visitdate', formatter: '.formatter.formatDate'}"
                                />
                            </table:template>
                        </table:Column>

                        <!-- Status Column -->
                        <table:Column filterProperty="Status">
                            <table:customData>
                                <core:CustomData
                                    key="p13nData"
                                    value='{"columnKey": "Status", "leadingProperty": "Status", "columnIndex": 4}'
                                />
                            </table:customData>
                            <Label text="{i18n>tableHeaderStatus}" />
                            <table:template>
                                <Text text="{Status}" />
                            </table:template>
                        </table:Column>

                        <!-- Details Column -->
                        <table:Column>
                            <table:customData>
                                <core:CustomData
                                    key="p13nData"
                                    value='{"columnKey": "Details", "columnIndex": 5}'
                                />
                            </table:customData>
                            <Label text="{i18n>tableHeaderDetails}" />
                            <table:template>
                                <Button
                                    text="{i18n>detailsButtonText}"
                                    icon="sap-icon://detail-view"
                                    type="Neutral"
                                    press="onShowDetails"
                                />
                            </table:template>
                        </table:Column>

                        <!-- Delete Column -->
                        <table:Column>
                            <table:customData>
                                <core:CustomData
                                    key="p13nData"
                                    value='{"columnKey": "Delete", "columnIndex": 6}'
                                />
                            </table:customData>
                            <Label text="{i18n>tableHeaderDelete}" />
                            <table:template>
                                <Button
                                    text="{i18n>deleteButtonText}"
                                    icon="sap-icon://delete"
                                    type="Reject"
                                    press="onDeleteOrder"
                                />
                            </table:template>
                            
                        </table:Column>
                    </table:Table>
                </smartTable:SmartTable>
            </VBox>
        </content>
    </Page>
</mvc:View>
